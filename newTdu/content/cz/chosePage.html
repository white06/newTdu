<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" style="height: 100%">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title>Title</title>
    <link rel="stylesheet" href="../../js/layui/css/layui.css">
    <script src="../../js/layui/layui.js"></script>
    <script src="../../js/custom/jquery-1.8.3.min.js"></script>
    <style>
        body {
            height: 100%;
            width: 100%;
            background: rgba(30,37,54,1);
        }

        .layui-form-item {
            margin: 0 0;
        }
    </style>
    <script>
        var sceneId = parent.layer.sceneId;
        var mark = parent.layer.mark;
        var type = parent.layer.type;
        var subTreeId = parent.layer.subTreeId;
        var userId = parent.layer.userId;
        $(document).ready(function () {
            var str = GetRequest();
            eval(str)
            sceneId = str.sceneId;
            mark = str.mark;
            type = str.type;
            subTreeId = str.subTreeId;
            userId = str.userId;
            console.log(sceneId, mark, type)

        })
        function GetRequest() {
            var url = location.search; //获取url中"?"符后的字串
            var theRequest = new Object();
            if (url.indexOf("?") != -1) {
                var str = url.substr(1);
                strs = str.split("&");
                for (var i = 0; i < strs.length; i++) {
                    theRequest[strs[i].split("=")[0]] = unescape(strs[i].split("=")[1]);
                }
            }
            return theRequest;
        }
    </script>
    <script src="../../js/api.js"></script>
</head>
<body>
<div style="width: 100%;height: 20%;text-align: center;">
    <fieldset class="layui-elem-field layui-field-title"
              style="margin: 0 0;display: inline-block;vertical-align: middle;color: white;">
        <legend>版本选择</legend>
    </fieldset>
    <span style="display: inline-block;vertical-align: middle;height: 100%;"></span>
</div>
<div class="layui-form" style="width: 80%;height: 60%;;margin: 0 auto;text-align: center;">

    <div class="layui-form-item" style="display: inline-block;vertical-align: middle;width: 100%;height: 30%;margin-top: 20%;">
        <div class="layui-input-block" style="color: white;margin: 0 0;">
            <input type="radio" name="sex" value="考试" title="考试">
            <input type="radio" name="sex" value="练习" title="练习" checked>
        </div>
    </div>

    <span style="display: inline-block;vertical-align: middle;height: 100%;"></span>
</div>
<div style="width: 80%;height: 20%;text-align: center;margin: 0 auto;">
    <div style="display: inline-block;vertical-align: middle;">
        <button onclick="getLingk()" style="width: 40%;margin-right: 10px;" class="layui-btn" >确认</button>
        <button onclick="returnPage()" style="width: 40%;" class="layui-btn">取消</button>
    </div>
    <span style="display: inline-block;vertical-align: middle;height: 100%;"></span>
</div>
</body>
<script>
    layui.use(['layer', 'table', 'element'], function () {
        var layer = layui.layer //弹层
            , table = layui.table //表格
            , element = layui.element //元素操作
        //常规用法
        window.returnPage=function () {
            var index = parent.layer.getFrameIndex(window.name);
            parent.layer.close(index); //再执行关闭
            //layer.close(index);
        }
        window.getLingk=function () {
            var flag = $('input[name="sex"]:checked').val();
            console.log(flag);
            if(flag=="考试"){
                type="2";
            }
            getSceneLink(sceneId,mark,type)
            var index = parent.layer.getFrameIndex(window.name);
            parent.layer.close(index); //再执行关闭
        }

    })

    function getSceneLink(sceneId,mark,type) {
        console.log(sceneId,mark,type)
        var scene=sceneId
        var count =mark;
        sceneId = Base64.encode(sceneId);
        mark = Base64.encode(mark);
        type = Base64.encode(type);

        //  mark 1-VR：TDuVREngine    2-编辑器 : TDuVRDirector  3-WEBGl :TDuSimEngine 4-仿真 :TDuSimEngine

        //  flag参数 1-模型  2-场景 3-资源类型

        var link = "tduvr://command=open&App=";
        if(count==1){
            link = link+"TDuVREngine";
        }else if(count==2){
            link = link+"TDuVRDirector";
        }else if(count==3){
            link = link+"TDuSimEngine";
        }else if(count==4){
            link = link+"TDuSimEngine";
        }
        link = link+"&knowledgeId="+sceneId+"&mark="+mark+"&type="+type+"&flag="+"2&";
        console.log(link);
        if(count!="3"){
            window.location.href=link;
        }else{
            if(scene=="e92eba19-f405-42b2-bfed-7ffc7f0df5a3"){
                window.open("https://tdu.tduvr.club/Interpretation/index.html?"+link+"&key="+userId);
            }else if(scene=="dbb7777c-0df5-47f2-9eb3-af0c0b383ef0"||scene=="e577ff7d-92d1-48c5-9f81-3674694963b0"
                ||scene=="14df764a-9c64-4def-918c-1d8a33d929ad"||scene=="5eb2b1d8-9d54-497c-9e8f-68ce5932f947"){
                window.open("https://tdu.tduvr.club/TDuCosmetics/index.html?"+link+"&key="+userId);
            }else if(scene=="aab89d48-3ca2-41e5-abb5-5bd0513c613f"){
                window.open("https://tdu.tduvr.club/BuildScan2/index-buildScan.html?"+link+"&key="+userId);
            }else if(scene=="9e8612ac-856b-4911-8bba-a4fdaeb484e8"){
                window.open("https://tdu.tduvr.club/BuildScan3/index-buildScan.html?"+link+"&key="+userId);
            }else if(scene=="8a831eb3-db90-4303-aaa5-89c0e21effa7"){
                window.open("https://tdu.tduvr.club/BuildScan4/index-buildScan.html?"+link+"&key="+userId);
            }else if(scene=="6bfc6c42-f9dc-44ab-9c4f-d14ca15ca860"){
                window.open("https://tdu.tduvr.club/BuildElectrical/index.html?"+link+"&key="+userId);
            }else if(scene=="53e868c1-ec76-4ea7-85e7-56133aa315e0"){
                window.open("https://tdu.tduvr.club/TDuHunNingTu/show/hunningtu.html?"+link+"&key="+userId);
            }else if(scene=="4437df7e-ce70-4a88-a164-80f393d826a5"){
                window.open("https://tdu.tduvr.club/TDuCo2fireSystem/index.html?"+link+"&key="+userId);
            }else if(scene == "8e6d8428-def5-427a-a88c-c621c25d69f4" || scene == "4018b621-52dc-4277-a48e-d3c4d5c35be2"
                || scene == "ee6a337f-17cd-4a23-8980-518b39f981ea") {
                window.open("https://tdu.tduvr.club/TDuLiyuanOpera/index.html?"+link+"&key="+userId);
            }else if(scene=="f6440981-26e4-4c3f-af1f-a43d979eec5f"){
                window.open("https://tdu.tduvr.club/TDuECU/index.html?"+link+"&key="+userId);
            }else if(scene=="d81b9ef2-bed1-42ce-9f22-342e9351d23e"){
                window.open("https://tdu.tduvr.club/TDuSeduJiankong/index.html?"+link+"&key="+userId);
            }else if(scene=="408e0167-2924-45df-9367-2e137f07d41f"){
                window.open("https://tdu.tduvr.club/TDuBlueOffice/index.html?"+link+"&key="+userId);
            }else if(scene=="24512b73-7a65-4fe2-975e-1b5ccc6d8571"){
                window.open("https://tdu.tduvr.club/MusicOffice/index-musicoffice.html?"+link+"&key="+userId);
            }else if(scene=="49ed746e-f131-4ce0-aab9-956fbf965fb8"||
                scene=="18132d4c-5691-4006-b61a-1f5f3ec3c07e"||scene=="1bd47b35-eea9-4615-b12b-3ac1d2265633"){
                window.open("https://tdu.tduvr.club/BuildScan/index-buildScan.html?"+link+"&key="+userId);
            }else if(scene=="bdd43444-e830-42b8-a78f-783bbc39788c"||
                scene=="b2a747bf-d6e8-4228-82b2-3b0a3806d9e9"){
                window.open("https://tdu.tduvr.club/BuildScan/index-buildScan.html?"+link+"&key="+userId);
            }else if(subTreeId=="a4bc82f4-f25c-4431-8562-6d2561ce082f"&&scene!="24512b73-7a65-4fe2-975e-1b5ccc6d8571"){
                window.open("https://tdu.tduvr.club/MusicOffice/index-musicoffice.html?"+link+"&key="+userId+"&isVisitor=scheme&");
            }else if(subTreeId=="a4b34abf-6c34-452e-aa13-899513bce279"){
                window.open("https://tdu.tduvr.club/TDuGeneVaccine/index.html?"+link+"&key="+userId+"&");
            }else if(subTreeId=="46fa8aaa-bcb3-48cd-8e3f-9f23c67111d2"){
                window.open("https://tdu.tduvr.club/TDuCultivatingCorals/index.html?"+link+"&key="+userId+"&");
            }else if(scene=="1fbc02bd-8c2f-43b7-a76e-bdfeb357d073"){
                window.open("https://tdu.tduvr.club/bagualou/index.html");
            }else if(scene=="7be6e298-22fb-4baf-a91c-8abdf5666607"){
                window.open("https://tdu.tduvr.club/TDuDemo/index.html?"+link+"&key="+userId+"&");
            }  else{
                window.open("https://tdu.tduvr.club/TDuWebEngine/index.html?"+link);
            }
        }

        console.log(sceneId,mark,type)
        $.ajax({
            url: "https://www.tduvr.club/tdu-base/DevelopScenesController/getLink.action",
            type: "POST",
            data: {"knowledgeId": sceneId,"mark":mark,"type":type},
            success: function (data) {
                //name = name + "KnowledgeID=" + knowContentId + "&OperateID=" + userId + "&"+ "loginId=" + data+"&";
                //   window.location.href=name;
                if(count!="3"){
                    //window.location.href=data
                }else{
                    //window.open(data);
                }
            },
            error: function () {
                return;
            }
        });
    }

    var Base64 = {
        _keyStr: "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",
        encode: function(e) {
            var t = "";
            var n, r, i, s, o, u, a;
            var f = 0;
            e = Base64._utf8_encode(e);
            while (f < e.length) {
                n = e.charCodeAt(f++);
                r = e.charCodeAt(f++);
                i = e.charCodeAt(f++);
                s = n >> 2;
                o = (n & 3) << 4 | r >> 4;
                u = (r & 15) << 2 | i >> 6;
                a = i & 63;
                if (isNaN(r)) {
                    u = a = 64
                } else if (isNaN(i)) {
                    a = 64
                }
                t = t + this._keyStr.charAt(s) + this._keyStr.charAt(o) + this._keyStr.charAt(u) + this._keyStr.charAt(a)
            }
            return t
        },
        decode: function(e) {
            var t = "";
            var n, r, i;
            var s, o, u, a;
            var f = 0;
            e=e.replace(/[^A-Za-z0-9+/=]/g,"");
            while (f < e.length) {
                s = this._keyStr.indexOf(e.charAt(f++));
                o = this._keyStr.indexOf(e.charAt(f++));
                u = this._keyStr.indexOf(e.charAt(f++));
                a = this._keyStr.indexOf(e.charAt(f++));
                n = s << 2 | o >> 4;
                r = (o & 15) << 4 | u >> 2;
                i = (u & 3) << 6 | a;
                t = t + String.fromCharCode(n);
                if (u != 64) {
                    t = t + String.fromCharCode(r)
                }
                if (a != 64) {
                    t = t + String.fromCharCode(i)
                }
            }
            t = Base64._utf8_decode(t);
            return t
        },
        _utf8_encode: function(e) {
            e = e.replace(/rn/g, "n");
            var t = "";
            for (var n = 0; n < e.length; n++) {
                var r = e.charCodeAt(n);
                if (r < 128) {
                    t += String.fromCharCode(r)
                } else if (r > 127 && r < 2048) {
                    t += String.fromCharCode(r >> 6 | 192);
                    t += String.fromCharCode(r & 63 | 128)
                } else {
                    t += String.fromCharCode(r >> 12 | 224);
                    t += String.fromCharCode(r >> 6 & 63 | 128);
                    t += String.fromCharCode(r & 63 | 128)
                }
            }
            return t
        },
        _utf8_decode: function(e) {
            var t = "";
            var n = 0;
            var r = c1 = c2 = 0;
            while (n < e.length) {
                r = e.charCodeAt(n);
                if (r < 128) {
                    t += String.fromCharCode(r);
                    n++
                } else if (r > 191 && r < 224) {
                    c2 = e.charCodeAt(n + 1);
                    t += String.fromCharCode((r & 31) << 6 | c2 & 63);
                    n += 2
                } else {
                    c2 = e.charCodeAt(n + 1);
                    c3 = e.charCodeAt(n + 2);
                    t += String.fromCharCode((r & 15) << 12 | (c2 & 63) << 6 | c3 & 63);
                    n += 3
                }
            }
            return t
        }
    }
</script>
</html>