<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" style="height: 100%">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <script src="../../js/api.js"></script>
</head>
<link rel="stylesheet" href="../../js/layui/css/layui.css">
<script src="../../js/layui/layui.js"></script>
<script src="../../js/custom/jquery-1.8.3.min.js"></script>
<style>
    body {
        height: 100%;
        width: 100%;
        background: rgba(30,37,54,1);
    }

    .layui-form-item {
        margin: 0 0;
    }
</style>
<script>
    var index = parent.layer.getFrameIndex(window.name);
    var subid1 = parent.layer.subid;
    var lei1 = parent.layer.lei;
    $(document).ready(function () {
        var str = GetRequest();
        eval(str)
        subid1 = str.subid;
        lei1 = str.lei;
        console.log(subid1, lei1)

    })
    function GetRequest() {
        var url = location.search; //获取url中"?"符后的字串
        var theRequest = new Object();
        if (url.indexOf("?") != -1) {
            var str = url.substr(1);
            strs = str.split("&");
            for (var i = 0; i < strs.length; i++) {
                theRequest[strs[i].split("=")[0]] = unescape(strs[i].split("=")[1]);
            }
        }
        return theRequest;
    }
    function saveFolder(name, sel) {
        sel=$("#sel").val();
        name=$("#name").val();
        sel="1"
        if (sel == null || sel == "") {
            layer.alert("请选择类别");
            return;
        }
        if (sel == "0") {
            var str = "random=" + Math.random() + "&Content=" + name + "&id=" + "" + "&lei=" + lei1 + "&subid=" + subid1;
            $.ajax({
                type: "Post",
                //url: "../../../TreesController/insScenes.action",
                url: informationurl+"DevelopModelController/AllinsModels.action",
                data: str,
                async: false,
                success: function (data) {

                    parent.layer.close(index);

                    // $("#contentDiv").load('content/cz/caozuo.php');
                    //    document.getElementById('divShow').contentWindow.location.reload(true);
                }
            });
        } else if (sel == "1") {
            var File1 = $("#dir")[0].files;
            if(File1.length==0){
                alert("请选择文件夹上传！");
                return
            }
            if(name==""){
                alert("请输入标题！");
                return
            }
            var data= new FormData;
            data.append("KnowledgeId","");
            data.append("name",name);
            data.append("cusstyle","default");
            data.append("treeId1",subid1);
            console.log(subid1)
            for(var i=0; i<File1.length;i++){
                data.append('file', File1[i]);
                //console.log(File1[i])
            }
            $.ajax({
                type: "Post",
                url: informationurl+"DevelopModelController/AddModelsContentFile.action",
                data:data,
                contentType:false,
                processData:false,
                async: false,
                success: function (data) {
                    parent.layer.close(index);
                }
            });
        }
    }
</script>
<body>


<div style="width: 100%;height: 20%;text-align: center;">
    <fieldset class="layui-elem-field layui-field-title"
              style="margin: 0 0;display: inline-block;vertical-align: middle;color: white;">
        <legend>模型</legend>
    </fieldset>
    <span style="display: inline-block;vertical-align: middle;height: 100%;"></span>
</div>


<div class="layui-form" style="width: 80%;height: 40%;;margin: 0 auto;text-align: center;">

    <div class="layui-form-item"
         style="margin: 0 22% 0 8%;width: 70%;text-align: center;margin-top: 20px;margin-bottom: 20px;display: none">
        <img src="../../img/三色—icon19.png" alt="">

        <div class="layui-input-block" style="display: inline-block;width: 70%;margin-left: 10%">
            <select lay-filter="business" name="interest" lay-verify="required" data-ratio="true" id="testSelect">
                <option value="0">文件夹</option>
                <option value="1" selected>模型</option>
            </select>
        </div>

    </div>

    <div id="file" class="layui-form-item" style="margin: 0 22% 0 8%;width: 70%;text-align: center;margin-top: 20px;margin-bottom: 20px;">
        <img src="../../img/三色—icon19备份.png" alt="">
        <div class="layui-input-block" style="display: inline-block;width: 70%;margin-left: 10%">
            <input type="hidden" name="type" value="1"/>
            <input id="dir" type="file" name="file" webkitdirectory mozdirectory style="width: auto;color: white;"/>
        </div>

    </div>

    <div class="item" style="margin:0 22% 0 8%;width: 70%;text-align: center;margin-top: 20px;margin-bottom: 20px;">
        <img src="../../img/三色—icon19.png" alt="">
        <div class="layui-input-block" style="display: inline-block;width: 70%;margin-left: 10%">
            <input type="text" name="Name"  lay-verify="title" autocomplete="off" placeholder="请输入模型名字"
                   class="layui-input" id="name">
        </div>
    </div>

</div>
<div style="width: 80%;height: 20%;text-align: center;margin: 0 auto;">
    <div style="display: inline-block;vertical-align: middle;">
        <button onclick="saveFolder($('input[name=Name]').val(),$('#testSelect option:selected') .val());" style="width: 40%;margin-right: 10px;" class="layui-btn" >确认</button>
        <button onclick="returnPage()" style="width: 40%;" class="layui-btn">取消</button>
    </div>
    <span style="display: inline-block;vertical-align: middle;height: 100%;"></span>
</div>

</body>

<script>
    layui.use('form', function () {
        var form = layui.form;

        //监听提交
        form.on('submit(formDemo)', function (data) {
            layer.msg(JSON.stringify(data.field));
            return false;
        });

        //常规用法
        window.returnPage=function () {
            var index = parent.layer.getFrameIndex(window.name);
            parent.layer.close(index); //再执行关闭
            //layer.close(index);
        }
    });
</script>