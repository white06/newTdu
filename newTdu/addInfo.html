

<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>设置我的密码</title>
  <meta name="renderer" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
  <link rel="stylesheet" href="js/layui/css/layui.css">
  <script type="text/javascript" language="javascript" src="js/jquery-3.5.1.js"></script>
  <script type="text/javascript" language="javascript" src="js/api.js"></script>
  <!--<script type="text/javascript" language="javascript" src="SysAdministrate/js/info.js"></script>-->
  <style>
    body{
      margin: 0 0;
      background: rgba(60, 65, 84, 1);
      height: 100%;
    }
    .layui-form-label{
      font-family:PingFangSC-Medium,PingFang SC;
      font-weight:500;
      color:rgba(255,255,255,1);
      width: 120px;text-align: center
    }
    .layui-btn{
      background:linear-gradient(337deg,rgba(92,205,177,1) 0%,rgba(92,205,178,1) 0%,rgba(89,208,207,1) 100%);
      border-radius:3px;
      width: 30%;
      margin-left: 10%;;
      margin-right: 10%;
    }
    .layui-input-inline{
      width:500px;
    }
    .layui-col-md6 {
      width: 80%;
    }
  </style>
</head>
<body>


<div style="margin:2% 2%;background:rgba(52,57,76,1);width: 96%;height: 96%;">
<!--  <form class="layui-form" action="" style="padding-left: 15%;-->
<!--            padding-right: 25%;padding-top: 35px;padding-bottom: 35px">-->
<div class="layui-form" action="" style="padding-left: 5%;
            padding-right: 10%;padding-top: 35px;padding-bottom: 35px">
    <div class="layui-form-item">
        <label class="layui-form-label">身份证号码</label>
        <div class="layui-col-md6">
            <input type="text" name="title" placeholder="身份证号码" autocomplete="off" class="layui-input" id="idNumber">
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">家庭住址</label>
        <div class="layui-col-md6">
            <input type="text" name="title" placeholder="家庭住址" autocomplete="off" class="layui-input" id="address">
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">邮箱</label>
        <div class="layui-col-md6">
            <input type="text" name="email" lay-verify="邮箱" autocomplete="off" class="layui-input" id="email">
        </div>
    </div>

    <div class="layui-form-item">
      <label class="layui-form-label">性别</label>
      <div class="layui-input-block" style="color: white">
        <input type="radio" name="sex" value="男" title="男" id="sexb">
        <input type="radio" name="sex" value="女" title="女" id="sexg">
      </div>
    </div>

    <div class="layui-form-item">
        <label class="layui-form-label">籍贯</label>
        <div class="layui-col-md6">
            <input type="text" name="title" placeholder="籍贯" autocomplete="off" class="layui-input" id="nativePlace">
        </div>
    </div>


    <div class="layui-form-item">
      <label class="layui-form-label">移动电话</label>
      <div class="layui-col-md6">
        <input type="text" name="title" placeholder="移动电话" autocomplete="off" class="layui-input" id="phone">
      </div>
    </div>
    <div class="layui-form-item">
      <label class="layui-form-label">QQ</label>
      <div class="layui-col-md6">
        <input type="text" name="title" placeholder="QQ" autocomplete="off" class="layui-input" id="QQ">
      </div>
    </div>

    <div class="layui-form-item">
        <label class="layui-form-label">微信</label>
        <div class="layui-col-md6">
            <input type="text" name="title" placeholder="WX" autocomplete="off" class="layui-input" id="wx">
        </div>
    </div>

    <div class="layui-form-item">
        <label class="layui-form-label">学校名称</label>
        <div class="layui-input-block">
            <div class="layui-inline">
                <select id="province" name="province" lay-filter="province" lay-verify="required">
                    <option value="">请选择省</option>
                    <option value="浙江" selected="">浙江省</option>
                    <option value="你的工号">江西省</option>
                    <option value="你最喜欢的老师">福建省</option>
                </select>
            </div>
            <div class="layui-inline">
                <select id="city" name="city" lay-filter="city" lay-verify="required">
                    <option value="">请选择市</option>
                    <option value="杭州">杭州</option>
                    <option value="宁波" disabled="">宁波</option>
                    <option value="温州">温州</option>
                    <option value="温州">台州</option>
                    <option value="温州">绍兴</option>
                </select>
            </div>
            <div class="layui-inline">
                <select id="school" name="school" lay-filter="school" lay-verify="required">
                    <option value="">请选择院校</option>
                    <option value="西湖区">西湖区</option>
                    <option value="余杭区">余杭区</option>
                    <option value="拱墅区">临安市</option>
                </select>
            </div>
        </div>
    </div>

    <div class="layui-form-item">
      <div class="layui-input-block">
        <button class="layui-btn" lay-submit lay-filter="setmypass" onclick="buchong()">确认补充</button>
      </div>
    </div>
</div>
<!--  </form>-->


</div>


<script src="http://libs.baidu.com/jquery/1.10.2/jquery.min.js"></script>
<script src="js/AllSchool.js"></script>
<script src="js/layui/layui.js"></script>
<script>

    function getuserinfo(){
        $.ajax({
            type : "POST",
            url : secondeurl+"UsersController/GetUserInfo.action",
            success : function(data) {
                if(data!=null){
                    console.log(data)
                    $("#idNumber").val(data.idNum);
                    $("#address").val(data.familyAddress);
                    if(data.sex=="女"){
                        $("#sexg").attr("checked","");
                    }else{
                        $("#sexb").attr("checked","");
                    }
                    $("#email").val(data.email);
                    $("#nativePlace").val(data.native);
                    $("#phone").val(data.mobilePhoneNum);
                    $("#QQ").val(data.qqNum);
                    $("#wx").val(data.wx);
                    $("#school").val(data.schoolName);
                    console.log(data.schoolName);
                    getSchool(data.schoolName);
                }
            }
        })
    }

    $(function() {
        var provinceArray = "";
        var provicneSelectStr = "";
        for(var i=0,len=province.length;i<len;i++){
            provinceArray = province[i];
            provicneSelectStr = provicneSelectStr + "<option value='"+provinceArray[0]+"'>"+provinceArray[1]+"</option>"
        }
        $("#province").html(provicneSelectStr);

        var selectCity = $("#province").val();
        var citylist=city[selectCity];
        var cityArray = "";
        var citySelectStr = "";
        for(var i=0,len=citylist.length;i<len;i++){
            cityArray = citylist[i];
            citySelectStr = citySelectStr + "<option value='"+cityArray[0]+"'>"+cityArray[1]+"</option>"
        }
        $("#city").html(citySelectStr);

        var selectschool = $("#city").val();
        var schoolUlStr = "";
        var schoolListStr = allschool[selectschool];
        for(var i=0,len=schoolListStr.length;i<len;i++){
            schoolUlStr = schoolUlStr + "<option >"+schoolListStr[i][2]+"</option>";
        }
        schoolUlStr = schoolUlStr + "<option value='999'>其它</option>";
        $("#school").html(schoolUlStr);
        $("#second").show();
        $("#restart").css("backgorund","url('assets/images/chongxintijiao.jpg') no-repeat");
        console.log("function");

    });
    /*window.onload=function(){
        var provinceArray = "";
        var provicneSelectStr = "";
        for(var i=0,len=province.length;i<len;i++){
            provinceArray = province[i];
            provicneSelectStr = provicneSelectStr + "<option value='"+provinceArray[0]+"'>"+provinceArray[1]+"</option>"
        }
        $("#province").html(provicneSelectStr);

        var selectCity = $("#province").val();
        var citylist=city[selectCity];
        var cityArray = "";
        var citySelectStr = "";
        for(var i=0,len=citylist.length;i<len;i++){
            cityArray = citylist[i];
            citySelectStr = citySelectStr + "<option value='"+cityArray[0]+"'>"+cityArray[1]+"</option>"
        }
        $("#city").html(citySelectStr);

        var selectschool = $("#city").val();
        var schoolUlStr = "";
        var schoolListStr = allschool[selectschool];
        for(var i=0,len=schoolListStr.length;i<len;i++){
            schoolUlStr = schoolUlStr + "<option >"+schoolListStr[i][2]+"</option>";
        }
        schoolUlStr = schoolUlStr + "<option value='999'>其它</option>";
        $("#school").html(schoolUlStr);
        //省切换事件
        $("#province").change(function(){
            var selectCity = $("#province").val();
            var citylist=city[selectCity];
            var cityArray = "";
            var citySelectStr = "";
            if(citylist!=null){
                for(var i=0,len=citylist.length;i<len;i++){
                    cityArray = citylist[i];
                    citySelectStr = citySelectStr + "<option value='"+cityArray[0]+"'>"+cityArray[1]+"</option>"
                }
            }

            $("#city").html(citySelectStr);
            $("#school1").show();
            $("#school2").hide();
            var selectschool = $("#city").val();
            var schoolUlStr = "";
            var schoolListStr = allschool[selectschool];
            for(var i=0,len=schoolListStr.length;i<len;i++){
                schoolUlStr = schoolUlStr + "<option >"+schoolListStr[i][2]+"</option>";
            }
            schoolUlStr = schoolUlStr + "<option value='999'>其它</option>";
            $("#school").html(schoolUlStr);
        });
        //切换城市事件
        $("#city").change(function(){
            $("#school1").show();
            $("#school2").hide();
            var selectschool = $("#city").val();
            var schoolUlStr = "";
            var schoolListStr = allschool[selectschool];
            for(var i=0,len=schoolListStr.length;i<len;i++){
                schoolUlStr = schoolUlStr + "<option >"+schoolListStr[i][2]+"</option>";
            }
            schoolUlStr = schoolUlStr + "<option value='999'>其它</option>";
            $("#school").html(schoolUlStr);
        });
        $("#school").change(function(){
            if($("#school").val()=="999"){
                $("#school1").hide();
                $("#school2").show();
            }
        });
        $("#second").show();
        $("#restart").css("backgorund","url('assets/images/chongxintijiao.jpg') no-repeat");
    }*/

    layui.use(['laydate', 'laypage', 'layer', 'table', 'carousel', 'upload', 'element','form'], function(){
        var laydate = layui.laydate //日期
            ,laypage = layui.laypage //分页
            ,layer = layui.layer //弹层
            ,table = layui.table //表格
            ,carousel = layui.carousel //轮播
            ,upload = layui.upload //上传
            ,form = layui.form
            ,element = layui.element //元素操作
        //常规用法
        laydate.render({
            elem: '#test1'
        });

        window.buchong=function () {
            var idNumber= $("#idNumber").val();
            var address= $("#address").val();
            var sex= $('input[name="sex"]:checked').val();
            var email= $("#email").val();
            var nativePlace= $("#nativePlace").val();
            var phone= $("#phone").val();
            var qq= $("#QQ").val();
            var wx= $("#wx").val();
            var school= $("#school").val();
            console.log(idNumber,address,sex,email,nativePlace,phone,qq,wx,school);
            $.ajax({
                type : "POST",
                url : secondeurl+"UsersController/addUserInfo.action",
                data: {"idNumber":idNumber,"address":address,"sex":sex,"email":email,"nativePlace":nativePlace,"phone":phone,"qq":qq,"wx":wx,"school":school},
                success : function(data) {
                    if(data==true){

                        var index = parent.layer.getFrameIndex(window.name);
                        parent.layer.close(index);//关闭当前页  
                        //window.parent.location.reload();
                    }
                }
            })
        }

        window.getSchool=function (str) {
            console.log(allschool.length)
            var count;
            var cityFlag=0;
            var provinceFlag=0;
            for (var index = 330; index >-1; index--) {
                count= index;
                if(index<100&&index>=10){
                    count = "0"+count.toString()
                }else if (index<10){
                    count = "00"+count.toString()
                }
                //console.log(count);
                //console.log(allschool[count]);
                if(count!=321){
                    if(count!=219) {

                        for (var i = 0; i < allschool[count].length; i++) {
                            //console.log(allschool[count][i]);
                            //console.log(allschool[count][i][2]);
                            if(allschool[count][i][2]==str){
                                cityFlag=count;
                            }
                        }
                    }
                }
            }
            console.log("  cityFlag :"+cityFlag)

            for (var index = 30; index >-1; index--) {
                count= index;
                if (index<10){
                    count = "0"+count.toString()
                }
                //console.log(count);
                //console.log(city[count]);
                        for (var i = 0; i < city[count].length; i++) {
                            //console.log(city[count][i]);
                            //console.log(city[count][i][1]);
                            if(city[count][i][0]==cityFlag){
                                provinceFlag=count;
                            }
                        }
            }
            console.log("  provinceFlag :"+provinceFlag)



            var select = 'dd[lay-value=' + provinceFlag + ']';
            $('#province').siblings("div.layui-form-select").find('dl').find(select).click();
            var select2 = 'dd[lay-value=' + cityFlag + ']';
            $('#city').siblings("div.layui-form-select").find('dl').find(select2).click();

            console.log(select)
            console.log(select2)


            var provinceArray = "";
            var provicneSelectStr = "";

                for(var i=0,len=province.length;i<len;i++){
                    provinceArray = province[i];
                    if(provinceArray[0]==cityFlag){
                        provicneSelectStr = provicneSelectStr + "<option selected='selected' value='"+provinceArray[0]+"'>"+provinceArray[1]+"</option>"
                    }else {
                        provicneSelectStr = provicneSelectStr + "<option value='"+provinceArray[0]+"'>"+provinceArray[1]+"</option>"
                    }
                }
                $("#province").html(provicneSelectStr);
            form.render('select', 'province');
                var selectCity = $("#province").val();
                var citylist=city[selectCity];
                var cityArray = "";
                var citySelectStr = "";
                if(citylist!=null){
                    for(var i=0,len=citylist.length;i<len;i++){
                        cityArray = citylist[i];
                        if(cityArray[0]==cityFlag){
                            citySelectStr = citySelectStr + "<option selected='selected' value='"+cityArray[0]+"'>"+cityArray[1]+"</option>"
                        }else {
                            citySelectStr = citySelectStr + "<option value='"+cityArray[0]+"'>"+cityArray[1]+"</option>"
                        }
                    }
                }

                $("#city").html(citySelectStr);

            form.render('select', 'city');

                $("#school1").show();
                $("#school2").hide();
                var selectschool = $("#city").val();
                var schoolUlStr = "";
                var schoolListStr = allschool[selectschool];
                for(var i=0,len=schoolListStr.length;i<len;i++){
                    if(schoolListStr[i][2]==str){
                        schoolUlStr = schoolUlStr + "<option selected='selected' >"+schoolListStr[i][2]+"</option>";
                    }else {
                        schoolUlStr = schoolUlStr + "<option >"+schoolListStr[i][2]+"</option>";
                    }
                }
                schoolUlStr = schoolUlStr + "<option value='999'>其它</option>";
                $("#school").html(schoolUlStr);
            form.render('select', 'school');
        }


        //省切换事件
        form.on('select(province)', function(data){

            console.log("province");

            var selectCity = $("#province").val();
            var citylist=city[selectCity];
            var cityArray = "";
            var citySelectStr = "";
            if(citylist!=null){
                for(var i=0,len=citylist.length;i<len;i++){
                    cityArray = citylist[i];
                    citySelectStr = citySelectStr + "<option value='"+cityArray[0]+"'>"+cityArray[1]+"</option>"
                }
            }

            $("#city").html(citySelectStr);
            $("#school1").show();
            $("#school2").hide();
            var selectschool = $("#city").val();
            var schoolUlStr = "";
            var schoolListStr = allschool[selectschool];
            for(var i=0,len=schoolListStr.length;i<len;i++){
                schoolUlStr = schoolUlStr + "<option >"+schoolListStr[i][2]+"</option>";
            }
            schoolUlStr = schoolUlStr + "<option value='999'>其它</option>";
            $("#school").html(schoolUlStr);
            form.render();
        });

//切换城市事件
        form.on('select(city)', function(data){

            console.log("city");

            $("#school1").show();
            $("#school2").hide();
            var selectschool = $("#city").val();
            var schoolUlStr = "";
            var schoolListStr = allschool[selectschool];
            for(var i=0,len=schoolListStr.length;i<len;i++){
                schoolUlStr = schoolUlStr + "<option >"+schoolListStr[i][2]+"</option>";
            }
            schoolUlStr = schoolUlStr + "<option value='999'>其它</option>";
            $("#school").html(schoolUlStr);
            form.render();
        });

        form.on('select(school)', function(data){
            if($("#school").val()=="999"){
                $("#school1").hide();
                $("#school2").show();
            }
            form.render();
        });
        getuserinfo();
        //自定义格式
        /*laydate.render({
            elem: '#test11'
         ,format: 'dd/MM/yyyy'
        });*/
    });
</script>
</body>
</html>