<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <!-- 开发环境版本，包含了有帮助的命令行警告 -->
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <!-- 生产环境版本，优化了尺寸和速度 -->
    <!--<script src="https://cdn.jsdelivr.net/npm/vue"></script>-->

    <!-- 引入样式 -->
<!--    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">-->
    <link rel="stylesheet" href="css/element_ui.css">
    <!-- 引入组件库 -->
<!--    <script src="https://unpkg.com/element-ui/lib/index.js"></script>-->
    <script src="js/element_ui.js"></script>

    <style>
        .el-dropdown-link {
            cursor: pointer;
            color: #409EFF;
        }
        .el-icon-arrow-down {
            font-size: 12px;
        }
    </style>
    <script src="js/jquery-1.8.3.min.js"></script>
</head>
<body>
<div id="app">

    <el-form ref="form" :model="form" label-width="80px">
        <el-form-item label="学校名称">
            <el-input v-model="form.name"></el-input>
        </el-form-item>
        <el-form-item label="学校地址">
            <el-input v-model="form.address"></el-input>
        </el-form-item>
        <el-form-item label="联系人">
            <el-input v-model="form.roleName"></el-input>
        </el-form-item>
        <el-form-item label="职务">
            <el-input v-model="form.roleJob"></el-input>
        </el-form-item>
        <el-form-item label="电话">
            <el-input v-model="form.rolePhone"></el-input>
        </el-form-item>
        <el-form-item label="合作次数">
            <el-input v-model="form.itemCount"></el-input>
        </el-form-item>
        <el-form-item label="省份" >
                <el-select @change="proChange" v-model="form.provincesValue" placeholder="请选择省份">
                    <el-option
                            v-for="(option,index) in provinces"
                            :key="option"
                            :label="option"
                            :value="option">
                    </el-option>
                </el-select>
        </el-form-item>
        <el-form-item label="城市" >
                <el-select @change="cityChange" v-model="form.cityValue" placeholder="请选择城市">
                    <el-option
                            v-for="(option,index) in citys"
                            :key="option"
                            :label="option"
                            :value="option">
                    </el-option>
                </el-select>
        </el-form-item>

        <el-form-item>
            <el-button type="primary" @click="onSubmit">立即修改</el-button>
            <el-button>取消</el-button>
        </el-form-item>
    </el-form>
</div>
</body>
<script src="js/proCity.js"></script>
<script>
    var app = new Vue({
        el: '#app',
        data: {
            cityChose:'',
            citFlag:false,
            chosePro:'',

            provinces:[],
            citys:[],
            shengId:'',
            form: {
                cityValue:'',
                provincesValue:'',
                name: '',
                address: '',
                roleName: '',
                roleJob: '',
                rolePhone: "",
                itemCount: '',
            }
        },
        computed: {
        },
        methods:{
            proChange(val){
                this.chosePro = this.provinces[val]
                if (val) {
                    this.citys = city[val]
                }
            },
            cityChange(val){
                if(val){
                    this.citFlag = true;
                    this.cityChose = this.citys[val];
                }else{
                    this.citFlag = false;
                }
            },

            onSubmit() {
                console.log('submit!');
            },
            GetRequest(){
                var url = location.search; //获取url中"?"符后的字串
                var theRequest = new Object();
                if (url.indexOf("?") != -1) {
                    var str = url.substr(1);
                    strs = str.split("&");
                    for (var i = 0; i < strs.length; i++) {
                        theRequest[strs[i].split("=")[0]] = unescape(strs[i].split("=")[1]);
                    }
                }
                return theRequest;
            },
            getUrlKey: function (name) {
                return decodeURIComponent((new RegExp('[?|&]' + name + '=' + '([^&;]+?)(&|#|;|$)').exec(location.href) || [, ""])[1].replace(/\+/g, '%20')) || null
            },
            checkparam: function () {

                // if (this.batchInforRequestVO.appkey == '' && this.batchInforRequestVO.batchnum == '') {
                //     vue.showcontent = true;
                //     vue.content = '查询参数不可以为空!';
                //     return false
                // }
                // else {
                //     return true
                // }
                return true

            },
            onSubmit() {
                let str = this.GetRequest();
                eval(str)
                let customerId = str.customerId
                console.log('submit!');

                var data = JSON.stringify(this.form); // 这里才是你的表单数据

                if (!app.checkparam()) {
                    return
                };
                //da.append("name", this.name)可以逐次添加多个参数
                console.log(data)
                console.log(this.form.name)
                console.log(this.form.address)
                console.log(this.form.roleName)
                console.log(this.form.roleJob)
                console.log(this.form.rolePhone)
                console.log(this.form.itemCount)

                $.ajax({								        //ajax提交
                    type:"POST",								//post方式
                    url:"http://192.168.0.94:8080/tdu-base/ItemController/createCustomer.action",			//请求路径
                    dataType:"json",							//json格式，返回的数据类型
                    data:{										//发送给控制器（controller）的数据
                        "customerId":customerId,
                        "name":this.form.name,
                        "address":this.form.address,
                        "roleName":this.form.roleName,
                        "roleJob":this.form.roleJob,
                        "rolePhone":this.form.rolePhone,
                        "itemCount":this.form.itemCount,
                        "sheng": this.form.provincesValue,
                        "shi":this.form.cityValue,
                        'shengId':this.shengId
                    },
                    success:function(result){
                        console.log(result)
                    }
                });
            },

        },


        mounted: function () {

            this.provinces = province;

            let str = this.GetRequest();
            eval(str)
            let customerId = str.customerId
            console.log(customerId)
            $.ajax({
                url: 'http://192.168.0.94:8080/tdu-base/ItemController/getCustomerforId.action?customerId='+customerId,
                type: 'post',
                contentType: 'application/json',
                dataType: 'JSON',
                success: function (data) {
                    console.log(data)
                    app.form.name = data.name;
                    app.form.address = data.address;
                    app.form.roleName = data.roleName;
                    app.form.roleJob = data.roleJob;
                    app.form.rolePhone = data.rolePhone;
                    app.form.itemCount = data.itemCount;
                },
                error: function (data) {
                    console.log(data)
                }
            });

            $.ajax({
                url: 'http://192.168.0.94:8080/tdu-base/ItemController/getAddressforId.action?customerId='+customerId,
                type: 'post',
                contentType: 'application/json',
                dataType: 'JSON',
                success: function (data) {
                    app.form.provincesValue = data.sheng;
                    app.form.cityValue = data.shi;
                    app.shengId = data.id;
                    for(temO in app.provinces) {
                        var bt=app.provinces[temO];
                        if(data.sheng.indexOf(bt)!=-1){
                            app.citys = city[temO]
                        }
                    }
                },
                error: function (data) {
                    console.log(data)
                }
            });

        },
        watch:{

        },

        filters:{},
    })
</script>
</html>