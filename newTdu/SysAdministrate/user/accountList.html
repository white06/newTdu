<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>學院</title>
    <link rel="stylesheet" href="../../js/layui/css/layui.css">
    <script src="../../js/custom/jquery-3.5.1.js"></script>
    <script type="text/javascript" language="javascript" src="../../js/api.js"></script>
    <script type="text/javascript" language="javascript" src="../js/accountList.js"></script>
    <style>
        /* 只针对谷歌浏览器*/
        body::-webkit-scrollbar {
            display: none;
        }
        body{
            margin: 0 0;
            background: rgba(60, 65, 84, 1);
        }


        .layui-form-label{
            color:rgba(255,255,255,1);
        }
        .layui-form{

        }
        .layui-input-block{
            margin-left: 150px;
        }
        .layui-form-item{
            margin-bottom: 20px;
        }
        .layui-btn{
            background:linear-gradient(337deg,rgba(92,205,177,1) 0%,rgba(92,205,178,1) 0%,rgba(89,208,207,1) 100%);
            border-radius:3px;
            width: 30%;
            margin-left: 10%;;
            margin-right: 10%;
        }
        .layui-card {
            background: #3C4154;
        }
        .layui-table[lay-skin=row] {
            border-top: 2px solid #2E3546;
            border-width: 2px;
            border-style: solid;
            border-color: #2E3546;
        }
        .layui-table{
            background: #3C4154;
            color: white;
        }
        .layui-table thead tr{
            background: #3C4154;
            color: white;
            border: 2px solid #2E3546;
        }
        .layui-table[lay-even] tr:nth-child(2n){
            background: #3C4154;
            border: 2px solid #2E3546;
        }
        .layui-table th{
            border-color: #2E3546;
        }
        .layui-table[lay-even] tr:nth-child(n){
            border-color: #2E3546;
        }
    </style>
    <script src="../../js/custom/jquery-1.8.3.min.js"></script>
</head>
<body>


<div style="margin:2% 2%;background:rgba(52,57,76,1);width: 96%;height: 96%;" id="userShow">
    <form class="layui-form" action="" style="padding-left: 14%;padding-right: 14%">


        <div style="margin:2% 2%;background:rgba(52,57,76,1);width: 96%;height: 96%;">
            <div class="layui-card" style="background:rgba(52,57,76,1);">
                <div class="layui-card-body layui-row layui-col-space10" style="text-align: center;width: 90%;padding-left: 1.5%;">
                    <div class="layui-col-md6" style="width: 40%;margin-left: 10%">
                        <input id="search" type="text" name="title" placeholder="请搜索" autocomplete="off" class="layui-input">
                        <button  onclick="chaxun()" type="button" class="layui-btn" style="margin: 0 0;position: absolute;top: 5px;right: 5px;"><i  class="layui-icon layui-icon-search"></i></button><!--style="color: #5CCDB2"-->
                    </div>
                    <button onclick="refresh()" style="width: auto;margin-top: 5px;vertical-align: middle;margin-left: 2%;margin-right: 2%" class="layui-btn layui-btn-radius">刷新账号</button>
                    <button onclick="tianjia()()" style="width: auto;margin-top: 5px;vertical-align: middle;margin-left: 2%;margin-right: 2%" type="button" class="layui-btn">添加账号</button>
                </div>

            </div>
        </div>

        <!--        <div class="layui-form-item" style="padding-top: 2.5%;padding-bottom: 2.5%;width: 80%">-->
<!--            <label class="layui-form-label" style="">名称 : </label>-->
<!--            <div class="layui-input-block" style=" ">-->
<!--                <input type="text" name="title" lay-verify="title" autocomplete="off" placeholder="请输入标题" class="layui-input">-->
<!--            </div>-->
<!--        </div>-->


        <div class="layui-fluid">
            <div class="layui-row layui-col-space15">
                <div center= class="layui-col-md12">
                    <div  class="layui-card" style="width: 1200px;margin: 0 auto">
                        <div class="layui-card-body">
                            <!--<div class="layui-btn-group test-table-operate-btn" style="margin-bottom: 10px;">
                                <button class="layui-btn" data-type="getCheckData">获取选中行数据</button>
                                <button class="layui-btn" data-type="getCheckLength">获取选中数目</button>
                                <button class="layui-btn" data-type="isAll">验证是否全选</button>
                            </div>-->
                            <table class="layui-table" lay-even="" lay-skin="row">
                                <colgroup>
                                    <col width="auto">
                                    <col width="auto">
                                    <col width="auto">
                                    <col>
                                </colgroup>
                                <thead >
                                <tr>
                                    <th>账号</th>
                                    <th>姓名</th>
                                    <th>创建日期</th>
                                    <th>性别</th>
                                    <th>操作</th>
                                </tr>
                                </thead>
                                <tbody id="test2">
                                <tr>
                                    <td>贤心</td>
                                    <td>汉族</td>
                                    <td>1989-10-14</td>
                                    <td>人生似修行</td>
                                    <td><a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>
                                        <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a></td>
                                </tr>
                                </tbody>

                            </table>
                            <div id="test-laypage-demo20"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>



        <div class="layui-form-item" style="padding-bottom: 1.5%;padding-top: 1.5%;display: none">
            <div class="layui-input-block">
                <button type="submit" class="layui-btn" lay-submit="" lay-filter="demo1">保存</button>
                <button type="submit" class="layui-btn">返回</button>
            </div>
        </div>
    </form>


</div>




<div style="margin:2% 2%;background:rgba(52,57,76,1);width: 96%;height: 96%;display: none" id="tianjia">
    <form class="layui-form" action="" style="padding-left: 15%;
            padding-right: 25%;">
        <div class="layui-form-item" style="padding-top: 30px">
            <label class="layui-form-label" style="">账号 : </label>
            <div class="layui-input-block" style=" ">
                <input type="text" name="title" lay-verify="title" autocomplete="off" placeholder="请输入标题" class="layui-input">
            </div>
        </div>

        <div class="layui-form-item">
            <label class="layui-form-label">姓名 : </label>
            <div class="layui-input-block">
                <input type="text" name="name" lay-verify="title" autocomplete="off" placeholder="请输入标题" class="layui-input">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">性别</label>
            <div class="layui-input-block" style="color: white">
                <input type="radio" name="sex" value="男" title="男" checked="">
                <input type="radio" name="sex" value="女" title="女">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">单选框</label>
            <div class="layui-input-block" style="color: white"  id="userRole">
                <input type="radio" name="role" value="3" title="学生" checked="">
                <input type="radio" name="role" value="2" title="老师">
                <input type="radio" name="role" value="1" title="管理员">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">密码 : </label>
            <div class="layui-input-block">
                <input type="text" name="password" lay-verify="password" lay-reqtext="用户名是必填项，岂能为空？" placeholder="请输入" autocomplete="off" class="layui-input">
            </div>
        </div>

        <div class="layui-form-item">

            <label class="layui-form-label">确认密码 : </label>
            <div class="layui-input-block"  >
                <input type="text" placeholder="请输入标题"  name="realpassword" lay-verify="password" autocomplete="off" class="layui-input">
            </div>
        </div>
        <div class="layui-form-item" style="padding-bottom: 20px;">
            <div class="layui-input-block">
                <button style="background:linear-gradient(337deg,rgba(92,205,177,1) 0%,rgba(92,205,178,1) 0%,rgba(89,208,207,1) 100%);
            border-radius:3px;
            width: 20%;
            margin-left: 10%;;display: inline-block;
            margin-right: 10%;" type="submit" class="layui-btn" lay-submit="" lay-filter="component-form-demo1">保存</button>
                <button  style="background:linear-gradient(337deg,rgba(92,205,177,1) 0%,rgba(92,205,178,1) 0%,rgba(89,208,207,1) 100%);
            border-radius:3px;
            width: 20%;
            margin-left: 10%;;display: inline-block;
            margin-right: 10%;" type="submit" class="layui-btn">返回</button>
            </div>
        </div>
    </form>


</div>


<div style="margin:2% 2%;background:rgba(52,57,76,1);width: 96%;height: 96%;display: none" id="bianji">
    <form class="layui-form" action="" style="padding-left: 15%;
            padding-right: 25%;">
<!--        <div class="layui-form-item" style="padding-top: 30px">-->
<!--            <label class="layui-form-label" style="">账号 : </label>-->
<!--            <div class="layui-input-block" style=" ">-->
<!--                <input type="text" name="title" lay-verify="title" autocomplete="off" placeholder="请输入标题" class="layui-input" id="title">-->
<!--            </div>-->
<!--        </div>-->
        <input id="userid"  type=hidden type="text" name="userid" lay-verify="userid" autocomplete="off"  class="layui-input">
        <div class="layui-form-item">
            <label class="layui-form-label">姓名 : </label>
            <div class="layui-input-block">
                <input id="name" type="text" name="name" lay-verify="title" autocomplete="off" placeholder="请输入标题" class="layui-input">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">性别</label>
            <div class="layui-input-block" style="color: white">
                <input id="sex1" type="radio" name="sex" value="男" title="男" checked="">
                <input id="sex2" type="radio" name="sex" value="女" title="女">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">单选框</label>
            <div class="layui-input-block" style="color: white">
                <input id="role1" type="radio" name="role" value="3" title="学生" checked="">
                <input id="role2" type="radio" name="role" value="2" title="老师">
                <input id="role3" type="radio" name="role" value="1" title="管理员">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">密码 : </label>
            <div class="layui-input-block">
                <input id="password" type="text" name="password" lay-verify="password" lay-reqtext="用户名是必填项，岂能为空？" placeholder="请输入" autocomplete="off" class="layui-input">
            </div>
        </div>

        <div class="layui-form-item">

            <label class="layui-form-label">确认密码 : </label>
            <div class="layui-input-block"  >
                <input id="realpassword" type="text" placeholder="请输入标题"  name="realpassword" lay-verify="password" autocomplete="off" class="layui-input">
            </div>
        </div>
        <div class="layui-form-item" style="padding-bottom: 20px;">
            <div class="layui-input-block">
                <button style="background:linear-gradient(337deg,rgba(92,205,177,1) 0%,rgba(92,205,178,1) 0%,rgba(89,208,207,1) 100%);
            border-radius:3px;
            width: 20%;
            margin-left: 10%;;display: inline-block;
            margin-right: 10%;" type="submit" class="layui-btn" lay-submit="" lay-filter="component-form-demo2">保存</button>
                <button  style="background:linear-gradient(337deg,rgba(92,205,177,1) 0%,rgba(92,205,178,1) 0%,rgba(89,208,207,1) 100%);
            border-radius:3px;
            width: 20%;
            margin-left: 10%;;display: inline-block;
            margin-right: 10%;" type="submit" class="layui-btn" >返回</button>
            </div>
        </div>
    </form>


</div>

<script src="../../js/layui/layui.js"></script>
<script>
    layui.use(['laydate', 'laypage', 'layer', 'table', 'carousel', 'upload', 'element','form'], function(){
        var laydate = layui.laydate //日期
            ,laypage = layui.laypage //分页
            ,layer = layui.layer //弹层
            ,table = layui.table //表格
            ,carousel = layui.carousel //轮播
            ,upload = layui.upload //上传
            ,form = layui.form
            ,element = layui.element //元素操作

        /* 监听提交新增 */
        form.on('submit(component-form-demo1)', function(data){
            if(data.field.title==""||data.field.title==null){
                layer.alert("账号不能为空!");
            }else if(data.field.name==""||data.field.name==null){
                layer.alert("姓名不能为空！");
            }else if(data.field.password==""||data.field.password==null){
                layer.alert("密码不能为空！");
            }else if(data.field.realpassword==""||data.field.realpassword==null){
                layer.alert("确认密码不能为空！");
            }else if(data.field.password!=data.field.realpassword){
                layer.alert("两次密码输入不一致！");
            }else{
                    $.ajax({
                        type : "POST",
                        url : userurl+"UsersController/insUser.action",
                        data : {"username":data.field.title,"name":data.field.name,"sex":data.field.sex,"password":data.field.password,"role":data.field.role},
                        success : function(data) {
                            if(data=="ture"){
                                location.reload();
                            }
                        }
                    })
                }
            console.log(data);
            parent.layer.alert(JSON.stringify(data.field), {
                title: '最终的提交信息'
            })
            return false;
        });


        /* 监听提交 编辑*/
        form.on('submit(component-form-demo2)', function(data){
            var id = $("#userid").val();
           if(data.field.name==""||data.field.name==null){
                layer.alert("姓名不能为空！");
            }else if(data.field.password==""||data.field.password==null){
                layer.alert("密码不能为空！");
            }else if(data.field.realpassword==""||data.field.realpassword==null){
                layer.alert("确认密码不能为空！");
            }else if(data.field.password!=data.field.realpassword){
                layer.alert("两次密码输入不一致！");
            }else{
                $.ajax({
                    type : "POST",
                    url : userurl+"UsersController/upUser.action",
                    data : {"id":id,"username":data.field.title,"name":data.field.name,"sex":data.field.sex,"password":data.field.password,"role":data.field.role},
                    success : function(data) {
                        if(data==true){
                            location.reload();
                        }
                        location.reload();
                    }
                })
            }
            console.log(data);
            /*parent.layer.alert(JSON.stringify(data.field), {
                title: '最终的提交信息'
            })*/
            return false;
        });
//编辑用户跳转
        window.bianji=function (id) {
            $("#bianji").show();
            $("#userShow").hide();
            $.ajax({
                type : "POST",
                url : userurl+"UsersController/getuserforid.action",
                data : {"id":id},
                success : function(data) {
                    console.log(data.id);
                    $("#userid").val(data.id);
                    console.log($("#userid").val())
                    $("#title").val(data.userName);
                    $("#name").val(data.name);
                    //     $(".sex").val(data.sex);
                    // $(".role").val(data.name);
                    $("#password").val(data.passWord);
                    $("#realpassword").val(data.passWord);


                }
            })
        }
        //监听工具条
        table.on('tool(test-table-operate)', function(obj){
            var data = obj.data;
            if(obj.event === 'detail'){
                layer.msg('ID：'+ data.id + ' 的查看操作');
            } else if(obj.event === 'del'){
                layer.confirm('真的删除行么', function(index){
                    obj.del();
                    layer.close(index);
                });
            } else if(obj.event === 'edit'){
                layer.alert('编辑行：<br>'+ JSON.stringify(data))
            }
        });

        window.chaxun=function () {
            layer.msg($("#search").val());
            var content =$("#search").val();
            $.ajax({
                type: "POST",
                url: houtaiurl+"UsersController/seleStuBySearch.action",
                data : {"content":content},
                async: false,
                success: function (data) {
                    testLayPageData = data;
                }
            });

            laypage.render({
                elem: 'test-laypage-demo20'
                , count: testLayPageData.length
                , jump: function (obj) {
                    //模拟渲染
                    document.getElementById('test2').innerHTML = function () {
                        console.log(obj.curr * obj.limit - obj.limit, obj.limit)
                        console.log(testLayPageData)
                        var arr = []
                            , thisData = testLayPageData.concat().splice(obj.curr * obj.limit - obj.limit, obj.limit);

                        console.log(thisData)
                        layui.each(thisData, function (index, item) {

                            var html = '<tr><th>';
                            html+=''+item.userName+'';
                            html+='</th><th>';
                            html+=''+item.name+'';
                            html+='</th><th>'
                            html+=''+item.createDate+'';
                            html+='</th><th>';
                            html+=''+item.sex+'';
                            html+='</th><td>';
                            html+=  '<a class="layui-btn layui-btn-xs" lay-event="edit" onclick="editUser(\'' + item.id + '\')" >编辑角色</a>';
                            html+='</td></tr>';
                            arr.push(html);
                        });
                        return arr.join('');
                    }();
                }
            });
        }

        window.refresh = function () {
            $.ajax({
                type: "POST",
                url: userurl+"UsersController/seleAllUsers.action",
                async: false,
                success: function (data) {
                    console.log(data);
                    testLayPageData = data;
                }
            });

            //调用分页
            laypage.render({
                elem: 'test-laypage-demo20'
                , count: testLayPageData.length
                , jump: function (obj) {
                    //模拟渲染
                    document.getElementById('test2').innerHTML = function () {
                        console.log(obj.curr * obj.limit - obj.limit, obj.limit)
                        console.log(testLayPageData)
                        var arr = []
                            , thisData = testLayPageData.concat().splice(obj.curr * obj.limit - obj.limit, obj.limit);

                        console.log(thisData)
                        layui.each(thisData, function (index, item) {

                            var html = '<tr><th>';
                            html+=''+item.userName+'';
                            html+='</th><th>';
                            html+=''+item.name+'';
                            html+='</th><th>'
                            html+=''+item.createDate+'';
                            html+='</th><th>';
                            html+=''+item.sex+'';
                            html+='</th><td>';
                            html+=  '<a class="layui-btn layui-btn-xs" lay-event="edit" onclick="bianji(\''+item.id+'\')">编辑</a>';
                            html+='<a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del" onclick="shanchu(\''+item.id+'\')">删除</a>';
                            html+='</td></tr>';
                            arr.push(html);
                        });
                        return arr.join('');
                    }();
                }
            });
        }


        //将一段数组分页展示

        //测试数据


        $.ajax({
            type: "POST",
            url: userurl+"UsersController/seleAllUsers.action",
            async: false,
            success: function (data) {
                console.log(data);
                testLayPageData = data;
            }
        });

        //调用分页
        laypage.render({
            elem: 'test-laypage-demo20'
            , count: testLayPageData.length
            , jump: function (obj) {
                //模拟渲染
                document.getElementById('test2').innerHTML = function () {
                    console.log(obj.curr * obj.limit - obj.limit, obj.limit)
                    console.log(testLayPageData)
                    var arr = []
                        , thisData = testLayPageData.concat().splice(obj.curr * obj.limit - obj.limit, obj.limit);

                    console.log(thisData)
                    layui.each(thisData, function (index, item) {

                        var html = '<tr><th>';
                        html+=''+item.userName+'';
                        html+='</th><th>';
                        html+=''+item.name+'';
                        html+='</th><th>'
                        html+=''+item.createDate+'';
                        html+='</th><th>';
                        html+=''+item.sex+'';
                        html+='</th><td>';
                        html+=  '<a class="layui-btn layui-btn-xs" lay-event="edit" onclick="bianji(\''+item.id+'\')">编辑</a>';
                        html+='<a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del" onclick="shanchu(\''+item.id+'\')">删除</a>';
                        html+='</td></tr>';
                        arr.push(html);
                    });
                    return arr.join('');
                }();
            }
        });

    });
</script>
</body>
</html>