<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="../scripts/UI/skin/css/base.css" />
    <link rel="stylesheet" href="../scripts/UI/skin/css/page.css" />

    <script type="text/javascript" src="../scripts/UI/js/jquery.js"></script>
    <script type="text/javascript" src="../scripts/PublicPoolName.js"></script>
    <script type="text/javascript" src="tea.js"></script>
    <!-- easyui -->
    <link rel="stylesheet" type="text/css" href="jquery-easyui-1.7.0/themes/default/easyui.css">
    <link rel="stylesheet" type="text/css" href="jquery-easyui-1.7.0/themes/icon.css">
    <link rel="stylesheet" type="text/css" href="jquery-easyui-1.7.0/demo/demo.css">
    <script type="text/javascript" src="jquery-easyui-1.7.0/jquery.min.js"></script>
    <script type="text/javascript" src="jquery-easyui-1.7.0/jquery.easyui.min.js"></script>

    <link rel="stylesheet" href="../../js/layui/css/layui.css">
    <script src="../../js/layui/layui.js"></script>
    <script src="../../js/custom/jquery-3.5.1.js"></script>
    <!--<script type="text/javascript" src="jquery-form.js"></script>-->
    <script src="../../js/layui/layui.js"></script>
    <link rel="stylesheet" href="../../js/layui/css/layui.css">

    <style type="text/css">
        table{
            margin-top:20px;
            border-collapse:collapse;
            width:100%;
        }
        table,td{
            border:1px solid #95B8E7;
        }
        th,td{
            padding-left:10px;
            text-align: center;
        }
        .tableth{
            padding-left:10px;
        }
        #bodydiv{
            height:70px;
        }
        #bodydiv2{
            margin-bottom:10px;
        }
        #bodydiv3{
            margin-bottom:10px;
        }
        #jump{
            color:blue;
        }


        /* 只针对谷歌浏览器*/
        body::-webkit-scrollbar {
            display: none;
        }
        body{
            margin: 0 0;
            background: rgba(60, 65, 84, 1);
        }
        .layui-form-label{
            font-size:18px;
            font-family:PingFangSC-Medium,PingFang SC;
            font-weight:500;
            color:rgba(255,255,255,1);
            width: 120px;text-align: center
        }
        .layui-form{

        }
        .layui-input-block{
            margin-left: 150px;
        }
        .layui-textarea {
            min-height: 100px;
            height: 100%;
            line-height: 20px;
            padding: 6px 10px;
            resize: vertical
        }
        .layui-form-item{
            margin-bottom: 20px;
        }
        .layui-btn{
            background:linear-gradient(337deg,rgba(92,205,177,1) 0%,rgba(92,205,178,1) 0%,rgba(89,208,207,1) 100%);
            border-radius:3px;
            width: 30%;
            margin-left: 10%;;
            margin-right: 10%;
        }
        .layui-table[lay-skin=row] {
            border-top: 2px solid #2E3546;
            border-width: 2px;
            border-style: solid;
            border-color: #2E3546;
        }
        .layui-table{
            background: #3C4154;
            color: white;
        }
        .layui-table thead tr{
            background: #3C4154;
            color: white;
            border: 2px solid #2E3546;
        }
        .layui-table[lay-even] tr:nth-child(2n){
            background: #3C4154;
            border: 2px solid #2E3546;
        }
        .layui-table th{
            border-color: #2E3546;
            text-align: center;
        }
        .layui-table[lay-even] tr:nth-child(n){
            border-color: #2E3546;
        }
        .layui-input, .layui-select, .layui-textarea {
            line-height: 1.3;
            line-height: 38px \9;
            border-width: 1px;
            border-style: solid;
            border-color:#3C4154 ;
            background-color: #3C4154;
            border-radius: 2px;
        }
        input::-webkit-input-placeholder {
            color: white;
        }
        .layui-input:hover, .layui-textarea:hover {
            color: white;
            border-color: #3C4154 !important
        }

        .layui-input:focus, .layui-textarea:focus {
            color: white;
            border-color: #3C4154 !important
        }
    </style>
    <script src="../../js/api.js"></script>
</head>
<body>

<div style="margin:2% 2% 1% 2%;background:rgba(52,57,76,1);width: 96%;height: 97%;">

<div class="page-wrap" style="max-width: 95%" >
    <div class="select-sty pt50" style="padding-top:20px;text-align: center;height: 70px;">
        <button type="button" class="layui-btn" style="margin: 0 20px;" onclick="daoByClass()">按班级导出</button>
        <!--<button type="button" class="layui-btn" style="margin: 0 20px;" onclick="daoByPage()">按试卷导出</button>-->
    </div>
    <div class="select-sty pt50" style="padding-top:20px;text-align: center;height: 70px;">
        <div style="font-size: 20px;color: white;width: 10%;display: inline-block">
            <span >学院&nbsp;:</span>
        </div>
        <select style="width: 75%;display: inline-block" class="ulib-r3" id="departselection" onchange="gradeChange()">
        </select>
    </div>
    <div class="select-sty pt50" style="padding-top:20px;text-align: center;height: 70px">
        <div style="font-size: 20px;color: white;width: 10%;display: inline-block">
            <span >专业&nbsp;:</span>
        </div>
        <select style="width: 75%;display: inline-block"  id="classId" onchange="classname();"></select>
</div>
    <div class="select-sty pt50" style="padding-top:20px;text-align: center;height: 70px">
        <div style="font-size: 20px;color: white;width: 10%;display: inline-block">
            <span >仿真&nbsp;:</span>
        </div>
        <select style="width: 75%;display: inline-block"  id="fangzhen" onchange="fangzhenname();"></select>
    </div>

    <div class="select-sty pt50" style="padding-top:20px;text-align: center;height: 70px">
        <div style="font-size: 20px;color: white;width: 10%;display: inline-block">
            <span >班级&nbsp;:</span>
        </div>
        <select style="width: 75%;display: inline-block"  id="classReally" onchange="classnameReally();"></select>
    </div>

    <div style="width: 95%;margin: 0 auto">
        <table class="layui-table" lay-even="" lay-skin="row">
            <colgroup>
                <col width="auto">
                <col width="auto">
                <col width="auto">
                <col>
            </colgroup>
            <thead >
            <tr>
                <th>学号</th>
                <th>姓名</th>
                <th>成绩</th>
            </tr>
            </thead>
            <tbody id="test2">
            <tr>
                <td>100</td>
                <td>学生数据加载中~</td>
                <td>100</td>
            </tr>
            </tbody>

        </table>
        <div id="test-laypage-demo20"></div></div>
</div>
</div>

<a id="examPage" style="display: none" ></a>

<script>
    layui.use(['laydate', 'laypage', 'layer', 'table', 'carousel', 'upload', 'element'], function(){
        var laydate = layui.laydate //日期
            ,laypage = layui.laypage //分页
            ,layer = layui.layer //弹层
            ,table = layui.table //表格
            ,carousel = layui.carousel //轮播
            ,upload = layui.upload //上传
            ,element = layui.element //元素操作


        //测试数据
        var testLayPageData = [
            '北京',
            '上海',
            '广州'
        ];
        //添加下拉框触发时间
        window.gradeChange=function () {
            getClass();
            getFangzhenReally();
            getClassReally();
            var classId=$('#classReally').val();
            var objS = document.getElementById("departselection");
            var grade = objS.options[objS.selectedIndex].value;
            var name= objS.options[objS.selectedIndex].innerHTML
            var url= houtaiurl+"ClassController/getClassUsers.action"
            layer.msg("学生数据加载中！请稍等~");
            $.post(url, {"classId":classId},function(Key) {
                showStudent(Key);
            });
        }
        window.classname=function () {
            getFangzhenReally();
            getClassReally();
            var classId=$('#classReally').val();
            var url= houtaiurl+"ClassController/getClassUsers.action"
            $.post(url, {"classId":classId},function(Key) {
                showStudent(Key);
            });
        }

        window.fangzhenname=function () {
            getClassReally();
            console.log($("#fangzhen").val())
            var classId=$('#classReally').val();
            var url= houtaiurl+"ClassController/getClassUsers.action"
            $.post(url, {"classId":classId},function(Key) {
                showStudent(Key);
            });
        }

        window.classnameReally=function () {
            var classId=$('#classReally').val();
            var url= houtaiurl+"ClassController/getClassUsers.action"
            $.post(url, {"classId":classId},function(Key) {
                showStudent(Key);
            });
        }

        //展示学生信息
        window.showStudent=function (Key) {

            //调用分页
            laypage.render({
                elem: 'test-laypage-demo20'
                , count: Key.length
                , jump: function (obj) {
                    //模拟渲染
                    document.getElementById('test2').innerHTML = function () {
                        console.log(obj.curr * obj.limit - obj.limit, obj.limit)
                        console.log(Key)
                        var arr = []
                            , thisData = Key.concat().splice(obj.curr * obj.limit - obj.limit, obj.limit);

                        console.log(thisData)
                        layui.each(thisData, function (index, item) {
                            getScore(item.id);
                            console.log(item);
                            var html = '<tr><th>';
                            html+=''+item.userName+'';
                            html+='</th><th>';
                            html+=''+item.name+'';
                            html+='</th><th>'
                            html+=''+score+'';
                            html+='</th></tr>';
                            arr.push(html);
                        });
                        return arr.join('');
                    }();
                }
            });

           /*var allModel=Key.length;
            $("#allModel").text(allModel);
            var allNum=Math.ceil(Key.length/20);
            $("#totalInfos").text(allNum);
            var html="";
            var num=parseInt($("#currentPage").text());
            var countNum=(num-1)*20;
            for(var j=0;j<20;j++){
                var count=j+countNum;
                if(count==allModel){
                    j=20;
                }else{
                    getScore(Key[count].id);

                    html+='<tr><td>'+Key[count].userName+'</td><td>'+Key[count].name+'</td><td><a id="jump" ;">'
                        //+'onclick="scores('+"'"+Key[count].id+"','"+Key[count].name+"'"+')">'
                        +''+score+''+'</a></td></tr>';
                }
            }
            $("#treeTbody").html("");
            $("#treeTbody").append(html);*/
        }
       /* $.ajax({
            type: "POST",
            url: "/develop/UsersController/seleAllUsers.action",
            async: false,
            success: function (data) {
                testLayPageData = data;
            }
        });*/


        gradeChange();
    });

    //分数
    var score=0;



    function getScore(userId){
        //var exam=$('#departselection').find("option:selected").attr("data-page");
        console.log($("#fangzhen option:selected").val())
        score=0;
        $.ajax({
            url:houtaiurl+"SubjectTreeController/getScoreTeacherNan.action",
            type:'POST',
            data:{"userId":userId,
                "rId":$("#fangzhen").val()
            },
            async: false,
            dataType:"json",
            success:function(data){
                console.log(data)
                if(data==null){
                    score=0;
                    console.log(1)
                }else{
                    score=data.quesScore;
                    console.log(2)
                }
            }
        });
        return score;
    }
</script>
</body>
</html>